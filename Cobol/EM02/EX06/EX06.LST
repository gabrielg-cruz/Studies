* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   1
*                                       EX06.CBL
* Options: LIST(EX06.LST) ASMLIST(EX06.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. EX06.
     3 AUTHOR. LUIZ HENRIQUE DE SANTANA / GABRIEL GOMES DA CRUZ.
     4 INSTALLATION. FATEC-SP.
     5 DATE-WRITTEN. 16/10/2023.
     6 DATE-COMPILED. 16-Oct-23 22:42.
     7 SECURITY. APENAS O AUTOR PODE LER E MODIFICAR.
     8
     9 ENVIRONMENT DIVISION.
    10 CONFIGURATION SECTION.
    11     OBJECT-COMPUTER. IBM-PC.
    12     SOURCE-COMPUTER. IBM-PC.
    13     SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    14
    15 INPUT-OUTPUT SECTION.
    16 FILE-CONTROL.
    17     SELECT CADCLI ASSIGN TO DISK ORGANIZATION IS LINE
    18         SEQUENTIAL.
    19     SELECT CADOK ASSIGN TO DISK ORGANIZATION IS LINE
    20         SEQUENTIAL.
    21     SELECT RELOCOR ASSIGN TO DISK.
    22
    23 DATA DIVISION.
    24 FILE SECTION.
    25 FD CADCLI LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS
    26     "CADCLI.DAT".
    27     01 REG-CLI.
    28       02 CODIGO-CLI       PIC 9(03).
    29       02 CPF-CLI          PIC 9(11).
    30       02 CPF-CLI-RED REDEFINES CPF-CLI.
    31         03 DIGT-1  PIC 9.
    32         03 DIGT-2  PIC 9.
    33         03 DIGT-3  PIC 9.
    34         03 DIGT-4  PIC 9.
    35         03 DIGT-5  PIC 9.
    36         03 DIGT-6  PIC 9.
    37         03 DIGT-7  PIC 9.
    38         03 DIGT-8  PIC 9.
    39         03 DIGT-9  PIC 9.
    40         03 DIGT-10 PIC 9.
    41         03 DIGT-11 PIC 9.
    42       02 NOME-CLI         PIC X(30).
    43         88 NOME-INVALIDO VALUE SPACES.
    44       02 ESTADO-CLI       PIC X(02).
    45         88 ESTADO-VALIDO VALUE
    46          "AC" "AL" "AP" "AM" "BA" "CE" "DF" "ES" "GO"
    47          "MA" "MT" "MS" "MG" "PA" "PB" "PR" "PE" "PI"
    48          "RJ" "RN" "RS" "RO" "RR" "SC" "SP" "SE" "TO".
    49       02 CIDADE-CLI       PIC X(30).
    50         88 CIDADE-INVALIDA VALUE SPACES.
    51       02 EMAIL-CLI        PIC X(30).
    52         88 EMAIL-INVALIDO VALUE SPACES.
    53       02 TELEFONE-CLI     PIC 9(10).
    54
    55 FD CADOK LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS
    56     "CADOK.DAT".
    57     01 REG-OK.
* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   2
*                                       EX06.CBL
    58       02 CPF-OK          PIC 9(11).
    59       02 NOME-OK         PIC X(30).
    60       02 ESTADO-OK       PIC X(02).
    61       02 CIDADE-OK       PIC X(30).
    62       02 EMAIL-OK        PIC X(30).
    63       02 TELEFONE-OK     PIC 9(10).
    64
    65 FD RELOCOR LABEL RECORD IS OMITTED.
    66     01 REL-OCOR PIC X(80) VALUE SPACES.
    67
    68 WORKING-STORAGE SECTION.
    69     77 FIM-ARQ PIC X(03) VALUE "NAO".
    70
    71     77 CT-LIN PIC 9(02) VALUE 31.
    72     77 CT-PAG PIC 9(03) VALUE ZEROS.
    73
    74     77 CH-ERRO PIC X(03) VALUE "NAO".
    75     77 ERROS-ENT PIC 9 OCCURS 5 TIMES.
    76     77 INDICE-ERRO PIC 9 VALUE 0.
    77
    78     77 CPF-VALIDO PIC X(03) VALUE "SIM".
    79     77 CPF-DIGT1-CORRETO PIC 9.
    80     77 CPF-DIGT2-CORRETO PIC 9.
    81     77 CPF-SOMA-MULT-DIGITOS PIC 9999 VALUE ZEROS.
    82     77 CPF-RESTO-DIV PIC 99 VALUE ZEROS.
    83     77 CPF-MULTI-DIGITOS PIC 99 OCCURS 10 TIMES.
    84
    85     01 TABELA-ERROS.
    86       02 FILLER PIC X(21) VALUE "CPF INVÁLIDO        ".
    87       02 FILLER PIC X(21) VALUE "NOME NÃO INFORMADO  ".
    88       02 FILLER PIC X(21) VALUE "ESTADO INVÁLIDO     ".
    89       02 FILLER PIC X(21) VALUE "CIDADE NÃO INFORMADA".
    90       02 FILLER PIC X(21) VALUE "EMAIL SEM DESCRIÇÃO".
    91
    92     01 TABELA-ERROS-VET REDEFINES TABELA-ERROS.
    93       02 ERROS PIC X(21) OCCURS 5 TIMES.
    94
    95     01 CAB-01.
    96       02 FILLER PIC X(32) VALUE SPACES.
    97       02 FILLER PIC X(17) VALUE "TURISMAR TURISMOS".
    98       02 FILLER PIC X(01) VALUE SPACES.
    99       02 FILLER PIC X(32) VALUE SPACES.
   100
   101     01 CAB-02.
   102       02 FILLER PIC X(17) VALUE SPACES.
   103       02 FILLER PIC X(23) VALUE "RELATÓRIO DE DADOS DE ".
   104       02 FILLER PIC X(23) VALUE "CLIENTES INCONSISTENTES".
   105       02 FILLER PIC X(17) VALUE SPACES.
   106
   107     01 CAB-03.
   108       02 FILLER PIC X(05) VALUE SPACES.
   109       02 FILLER PIC X(18) VALUE "CÓDIGO DO CLIENTE".
   110       02 FILLER PIC X(05) VALUE SPACES.
   111       02 FILLER PIC X(16) VALUE "DADOS INVÁLIDOS".
   112       02 FILLER PIC X(36) VALUE SPACES.
   113
   114     01 CAB-04.
   115       02 FILLER PIC X(80) VALUE ALL "-".
* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   3
*                                       EX06.CBL
   116
   117     01 DETALHE.
   118       02 FILLER PIC X(13) VALUE SPACES.
   119       02 DET-COD PIC X(03).
   120       02 FILLER PIC X(12) VALUE SPACES.
   121       02 DET-ERRO PIC X(22).
   122       02 FILLER PIC X(30) VALUE SPACES.
   123
   124 PROCEDURE DIVISION.
   125 PGM-EX06.
   126     PERFORM INICIO.
   127     PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL "SIM".
   128     PERFORM TERMINO.
   129     STOP RUN.
   130
   131 INICIO.
   132     OPEN INPUT CADCLI OUTPUT CADOK RELOCOR.
   133     PERFORM LEITURA.
   134
   135 LEITURA.
   136     READ CADCLI AT END MOVE "SIM" TO FIM-ARQ.
   137
   138 PRINCIPAL.
   139     PERFORM VALIDACAO.
   140     IF CH-ERRO EQUAL "SIM"
   141         PERFORM IMPRESSAO-REL
   142     ELSE
   143         PERFORM GRAVACAO-CADOK.
   144
   145     PERFORM LEITURA.
   146
   147 VALIDACAO.
   148     PERFORM VALIDAR-CPF.
   149     IF (CPF-VALIDO EQUAL "NAO") OR (NOME-INVALIDO) OR
   150        (NOT ESTADO-VALIDO) OR (CIDADE-INVALIDA) OR
   151        (EMAIL-INVALIDO)
   152         MOVE "SIM" TO CH-ERRO
   153         PERFORM CAPTURAR-ERROS
   154     ELSE
   155         MOVE "NAO" TO CH-ERRO.
   156
   157 CAPTURAR-ERROS.
   158     IF CPF-VALIDO EQUAL "NAO"
   159       MOVE 1 TO ERROS-ENT(1)
   160     ELSE
   161       MOVE 0 TO ERROS-ENT(1).
   162
   163     IF NOME-INVALIDO
   164       MOVE 1 TO ERROS-ENT(2)
   165     ELSE
   166       MOVE 0 TO ERROS-ENT(2).
   167
   168     IF (NOT ESTADO-VALIDO)
   169       MOVE 1 TO ERROS-ENT(3)
   170     ELSE
   171       MOVE 0 TO ERROS-ENT(3).
   172
   173     IF CIDADE-INVALIDA
* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   4
*                                       EX06.CBL
   174       MOVE 1 TO ERROS-ENT(4)
   175     ELSE
   176       MOVE 0 TO ERROS-ENT(4).
   177
   178     IF EMAIL-INVALIDO
   179       MOVE 1 TO ERROS-ENT(5)
   180     ELSE
   181       MOVE 0 TO ERROS-ENT(5).
   182
   183 IMPRESSAO-REL.
   184     IF CT-LIN GREATER THAN 30
   185         PERFORM CABECALHO.
   186     PERFORM IMP-DET.
   187
   188 CABECALHO.
   189     MOVE 1 TO CT-LIN.
   190     ADD 1 TO CT-PAG.
   191     MOVE SPACES TO REL-OCOR.
   192     WRITE REL-OCOR AFTER ADVANCING PAGE.
   193     WRITE REL-OCOR FROM CAB-01 AFTER ADVANCING 1 LINE.
   194     WRITE REL-OCOR FROM CAB-02 AFTER ADVANCING 2 LINES.
   195     WRITE REL-OCOR FROM CAB-03 AFTER ADVANCING 2 LINES.
   196     WRITE REL-OCOR FROM CAB-04 AFTER ADVANCING 1 LINE.
   197     MOVE SPACES TO REL-OCOR.
   198     WRITE REL-OCOR AFTER ADVANCING 1 LINE.
   199
   200 IMP-DET.
   201     MOVE CODIGO-CLI TO DET-COD.
   202     PERFORM IMP-ERROS 5 TIMES.
   203     MOVE 0 TO INDICE-ERRO.
   204
   205     MOVE SPACES TO REL-OCOR.
   206     WRITE REL-OCOR AFTER ADVANCING 1 LINE.
   207     ADD 1 TO CT-LIN.
   208
   209     MOVE 0 TO ERROS-ENT(1).
   210     MOVE 0 TO ERROS-ENT(2).
   211     MOVE 0 TO ERROS-ENT(3).
   212     MOVE 0 TO ERROS-ENT(4).
   213     MOVE 0 TO ERROS-ENT(5).
   214
   215 IMP-ERROS.
   216     ADD 1 TO INDICE-ERRO.
   217     IF ERROS-ENT(INDICE-ERRO) EQUAL 1
   218       MOVE ERROS(INDICE-ERRO) TO DET-ERRO
   219       WRITE REL-OCOR FROM DETALHE AFTER ADVANCING 1 LINE
   220       MOVE SPACES TO DET-COD
   221
   222       IF CT-LIN GREATER THAN 30
   223          MOVE 0 TO INDICE-ERRO
   224          PERFORM CABECALHO
   225          PERFORM IMP-DET
   226       END-IF
   227       ADD 1 TO CT-LIN
   228     END-IF.
   229
   230 GRAVACAO-CADOK.
   231     MOVE CPF-CLI TO CPF-OK.
* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   5
*                                       EX06.CBL
   232     MOVE NOME-CLI TO NOME-OK.
   233     MOVE ESTADO-CLI TO ESTADO-OK.
   234     MOVE CIDADE-CLI TO CIDADE-OK.
   235     MOVE EMAIL-CLI TO EMAIL-OK.
   236     MOVE TELEFONE-CLI TO TELEFONE-OK.
   237     WRITE REG-OK.
   238
   239 VALIDAR-CPF.
   240     IF CPF-CLI IS NUMERIC
   241       IF CPF-CLI EQUAL 11111111111 OR
   242          CPF-CLI EQUAL 22222222222 OR
   243          CPF-CLI EQUAL 33333333333 OR
   244          CPF-CLI EQUAL 44444444444 OR
   245          CPF-CLI EQUAL 55555555555 OR
   246          CPF-CLI EQUAL 66666666666 OR
   247          CPF-CLI EQUAL 77777777777 OR
   248          CPF-CLI EQUAL 88888888888 OR
   249          CPF-CLI EQUAL 99999999999
   250             MOVE "NAO" TO CPF-VALIDO
   251       ELSE
   252         MULTIPLY 10 BY DIGT-1 GIVING CPF-MULTI-DIGITOS(1)
   253         MULTIPLY 09 BY DIGT-2 GIVING CPF-MULTI-DIGITOS(2)
   254         MULTIPLY 08 BY DIGT-3 GIVING CPF-MULTI-DIGITOS(3)
   255         MULTIPLY 07 BY DIGT-4 GIVING CPF-MULTI-DIGITOS(4)
   256         MULTIPLY 06 BY DIGT-5 GIVING CPF-MULTI-DIGITOS(5)
   257         MULTIPLY 05 BY DIGT-6 GIVING CPF-MULTI-DIGITOS(6)
   258         MULTIPLY 04 BY DIGT-7 GIVING CPF-MULTI-DIGITOS(7)
   259         MULTIPLY 03 BY DIGT-8 GIVING CPF-MULTI-DIGITOS(8)
   260         MULTIPLY 02 BY DIGT-9 GIVING CPF-MULTI-DIGITOS(9)
   261
   262         ADD CPF-MULTI-DIGITOS(1) CPF-MULTI-DIGITOS(2)
   263             CPF-MULTI-DIGITOS(3) CPF-MULTI-DIGITOS(4)
   264             CPF-MULTI-DIGITOS(5) CPF-MULTI-DIGITOS(6)
   265             CPF-MULTI-DIGITOS(7) CPF-MULTI-DIGITOS(8)
   266             CPF-MULTI-DIGITOS(9) TO CPF-SOMA-MULT-DIGITOS
   267
   268         DIVIDE CPF-SOMA-MULT-DIGITOS BY 11
   269             GIVING CPF-RESTO-DIV REMAINDER CPF-RESTO-DIV
   270
   271         IF CPF-RESTO-DIV LESS THAN 2
   272             MOVE 0 TO CPF-DIGT1-CORRETO
   273         ELSE
   274             SUBTRACT CPF-RESTO-DIV FROM 11
   275                 GIVING CPF-DIGT1-CORRETO
   276         END-IF
   277             MOVE 0 TO CPF-SOMA-MULT-DIGITOS
   278
   279         MULTIPLY 11 BY DIGT-1 GIVING CPF-MULTI-DIGITOS(1)
   280         MULTIPLY 10 BY DIGT-2 GIVING CPF-MULTI-DIGITOS(2)
   281         MULTIPLY 09 BY DIGT-3 GIVING CPF-MULTI-DIGITOS(3)
   282         MULTIPLY 08 BY DIGT-4 GIVING CPF-MULTI-DIGITOS(4)
   283         MULTIPLY 07 BY DIGT-5 GIVING CPF-MULTI-DIGITOS(5)
   284         MULTIPLY 06 BY DIGT-6 GIVING CPF-MULTI-DIGITOS(6)
   285         MULTIPLY 05 BY DIGT-7 GIVING CPF-MULTI-DIGITOS(7)
   286         MULTIPLY 04 BY DIGT-8 GIVING CPF-MULTI-DIGITOS(8)
   287         MULTIPLY 03 BY DIGT-9 GIVING CPF-MULTI-DIGITOS(9)
   288         MULTIPLY 02 BY CPF-DIGT1-CORRETO
   289             GIVING CPF-MULTI-DIGITOS(10)
* Microsoft COBOL Version 4.5        L2.4 revision 002 16-Oct-23 22:42 Page   6
*                                       EX06.CBL
   290
   291         ADD CPF-MULTI-DIGITOS(1) CPF-MULTI-DIGITOS(2)
   292             CPF-MULTI-DIGITOS(3) CPF-MULTI-DIGITOS(4)
   293             CPF-MULTI-DIGITOS(5) CPF-MULTI-DIGITOS(6)
   294             CPF-MULTI-DIGITOS(7) CPF-MULTI-DIGITOS(8)
   295             CPF-MULTI-DIGITOS(9) CPF-MULTI-DIGITOS(10)
   296             TO CPF-SOMA-MULT-DIGITOS
   297
   298         DIVIDE CPF-SOMA-MULT-DIGITOS BY 11
   299             GIVING CPF-RESTO-DIV REMAINDER CPF-RESTO-DIV
   300
   301         IF CPF-RESTO-DIV LESS THAN 2
   302            MOVE 0 TO CPF-DIGT2-CORRETO
   303         ELSE
   304            SUBTRACT CPF-RESTO-DIV FROM 11
   305                GIVING CPF-DIGT2-CORRETO
   306         END-IF
   307         MOVE 0 TO CPF-SOMA-MULT-DIGITOS
   308
   309         IF (DIGT-10 NOT EQUAL CPF-DIGT1-CORRETO) OR
   310            (DIGT-11 NOT EQUAL CPF-DIGT2-CORRETO)
   311               MOVE "NAO" TO CPF-VALIDO
   312         ELSE
   313            MOVE "SIM" TO CPF-VALIDO
   314         END-IF
   315       END-IF
   316     ELSE
   317         MOVE "NAO" TO CPF-VALIDO
   318     END-IF.
   319
   320     MOVE 0 TO CPF-DIGT1-CORRETO.
   321     MOVE 0 TO CPF-DIGT2-CORRETO.
   322     MOVE 0 TO CPF-SOMA-MULT-DIGITOS.
   323     MOVE 0 TO CPF-RESTO-DIV.
   324
   325 TERMINO.
   326     CLOSE CADCLI CADOK RELOCOR.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2076     Code:        2125     Dictionary:        3551
